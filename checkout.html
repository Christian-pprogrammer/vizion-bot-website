<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Vizion Bot</title>
    <link rel="stylesheet" type="text/css" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/font-awesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-softy-pinko.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        :root {
            --primary-dark: #0079A5;
            --primary-light: #3EC6EC;
            --dark-blue: #1a365d;
            --light-gray: #f7fafc;
            --medium-gray: #e2e8f0;
            --dark-gray: #2d3748;
            --success: #38a169;
            --warning: #d69e2e;
            --danger: #e53e3e;
            --white: #ffffff;
        }

        * {
            box-sizing: border-box;
        }

        .checkout-page-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #f7fafc 0%, #e2e8f0 100%);
            padding-top: 130px;
            padding-bottom: 150px;
        }

        .checkout-container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 121, 165, 0.1);
            overflow: hidden;
        }

        .progress-header {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            padding: 40px 50px;
            color: var(--white);
        }

        .progress-steps {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .step.clickable:hover .step-number {
            transform: scale(1.05);
        }

        .step-number {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            /* background: rgba(255, 255, 255, 0.15); */
             background: var(--primary-dark); /* Solid background */
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }

        .step.active .step-number {
            background: var(--white);
            color: var(--primary-dark);
            border-color: var(--white);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.3);
        }

        .step.completed .step-number {
            background: var(--success);
            border-color: var(--success);
            color: var(--white);
        }

        /* .step.completed .step-number::after {
            content: '\f00c';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        } */

        .step.completed .step-number span {
            /* display: none; */
        }

        .step-title {
            font-size: 14px;
            text-align: center;
            opacity: 0.8;
            font-weight: 500;
            margin-top: 4px;
        }

        .step.active .step-title {
            opacity: 1;
            font-weight: 600;
        }

        .progress-line {
            position: absolute;
            top: 25px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        .progress-fill {
            height: 100%;
            background: var(--white);
            transition: width 0.5s ease;
            border-radius: 1px;
        }

        .checkout-content {
            padding: 50px;
        }

        .step-header {
            margin-bottom: 40px;
        }

        .step-header h2 {
            color: var(--dark-gray);
            font-weight: 600;
            font-size: 28px;
            margin-bottom: 8px;
        }

        .step-header p {
            color: #718096;
            font-size: 16px;
            margin: 0;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(62, 198, 236, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%);
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            color: var(--white);
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 121, 165, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #718096;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            color: var(--white);
            font-weight: 500;
            cursor: pointer;
            margin-right: 12px;
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: #4a5568;
            transform: translateY(-1px);
        }

        .product-card {
            border: 2px solid var(--medium-gray);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--white);
        }

        .product-card:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(62, 198, 236, 0.15);
        }

        .product-card.selected {
            border-color: var(--primary-dark);
            background: linear-gradient(135deg, rgba(0, 121, 165, 0.03) 0%, rgba(62, 198, 236, 0.03) 100%);
            box-shadow: 0 8px 25px rgba(0, 121, 165, 0.2);
        }

        .product-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
        }

        .product-left {
            display: flex;
            align-items: center;
            gap: 16px;
            flex: 1;
        }

        .product-image {
            width: 64px;
            height: 164px;
            border-radius: 12px;
            /* background: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary-light) 100%); */
            /* display: flex;
            align-items: center;
            justify-content: center; */
            color: var(--white);
            font-weight: 600;
            font-size: 20px;
        }

        .product-details h4 {
            color: var(--dark-gray);
            margin-bottom: 4px;
            font-weight: 600;
            font-size: 18px;
        }

        .product-details p {
            color: #718096;
            margin: 0;
            font-size: 14px;
        }

        .product-right {
            text-align: right;
        }

        .product-price {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 8px;
        }

        .select-btn {
            background: var(--primary-dark);
            color: var(--white);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-btn:hover {
            background: var(--primary-light);
        }

        .quantity-section {
            background: var(--light-gray);
            padding: 20px;
            border-radius: 8px;
            margin: 24px 0;
        }

        .quantity-input {
            max-width: 120px;
            margin: 0;
        }

        .delivery-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 24px 0;
        }

        .delivery-option {
            border: 2px solid var(--medium-gray);
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .delivery-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }

        .delivery-option.selected {
            border-color: var(--primary-dark);
            background: linear-gradient(135deg, rgba(0, 121, 165, 0.03) 0%, rgba(62, 198, 236, 0.03) 100%);
        }

        .delivery-icon {
            font-size: 32px;
            color: var(--primary-dark);
            margin-bottom: 12px;
        }

        .delivery-option h4 {
            color: var(--dark-gray);
            font-weight: 600;
            margin-bottom: 6px;
        }

        .delivery-option p {
            color: #718096;
            margin: 0;
            font-size: 14px;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 24px 0;
        }

        .payment-method {
            border: 2px solid var(--medium-gray);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white);
            position: relative;
        }

        .payment-method:hover:not(.disabled) {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }

        .payment-method.selected {
            border-color: var(--primary-dark);
            background: linear-gradient(135deg, rgba(0, 121, 165, 0.03) 0%, rgba(62, 198, 236, 0.03) 100%);
        }

        .payment-method.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f9fa;
        }

        .payment-method.disabled::after {
            content: 'Coming Soon';
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--warning);
            color: var(--white);
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }

        .payment-icon {
            font-size: 28px;
            margin-bottom: 12px;
        }

        .network-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin: 20px 0;
        }

        .network-option {
            border: 2px solid var(--medium-gray);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .network-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-1px);
        }

        .network-option.selected {
            border-color: var(--primary-dark);
            background: linear-gradient(135deg, rgba(0, 121, 165, 0.03) 0%, rgba(62, 198, 236, 0.03) 100%);
        }

        .network-image {
            width: 40px;
            height: 40px;
            object-fit: contain;
            margin-bottom: 8px;
            border-radius: 6px;
        }

        .network-name {
            font-size: 12px;
            font-weight: 600;
            color: var(--dark-gray);
        }

        .order-summary {
            background: var(--light-gray);
            padding: 24px;
            border-radius: 12px;
            margin: 24px 0;
            border: 1px solid var(--medium-gray);
        }

        .summary-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-gray);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
        }

        .summary-row.total {
            border-top: 2px solid var(--medium-gray);
            padding-top: 16px;
            margin-top: 16px;
            font-weight: 700;
            font-size: 18px;
            color: var(--primary-dark);
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 24px 0;
        }

        .checkbox-group input[type="checkbox"] {
            margin-top: 4px;
            transform: scale(1.2);
            accent-color: var(--primary-dark);
        }

        .checkbox-group label {
            color: var(--dark-gray);
            line-height: 1.5;
            cursor: pointer;
        }

        .success-container {
            text-align: center;
            padding: 60px 40px;
        }

        .success-icon {
            font-size: 80px;
            color: var(--success);
            margin-bottom: 24px;
        }

        .success-title {
            color: var(--success);
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .success-message {
            font-size: 18px;
            color: #718096;
            margin-bottom: 32px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .order-details-card {
            background: var(--white);
            border: 1px solid var(--medium-gray);
            border-radius: 12px;
            padding: 24px;
            text-align: left;
            max-width: 500px;
            margin: 0 auto 32px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .detail-value {
            color: #718096;
        }

        .hidden {
            display: none !important;
        }

        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-danger {
            background: rgba(229, 62, 62, 0.1);
            color: var(--danger);
            border: 1px solid rgba(229, 62, 62, 0.2);
        }

        .alert-warning {
            background: rgba(214, 158, 46, 0.1);
            color: var(--warning);
            border: 1px solid rgba(214, 158, 46, 0.2);
        }

        .alert-info {
            background: rgba(0, 121, 165, 0.1);
            color: var(--primary-dark);
            border: 1px solid rgba(0, 121, 165, 0.2);
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid var(--white);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .button-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 32px;
        }

        .button-group .btn-primary {
            flex: 1;
        }

        @media (max-width: 768px) {
            .checkout-content {
                padding: 30px 20px;
            }
            
            .progress-header {
                padding: 30px 20px;
            }
            
            .progress-steps {
                flex-wrap: wrap;
                gap: 16px;
            }
            
            .step {
                min-width: 120px;
            }
            
            .delivery-options,
            .payment-methods {
                grid-template-columns: 1fr;
            }
            
            .network-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .product-info {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }
            
            .product-right {
                align-self: stretch;
                text-align: left;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .button-group .btn-primary {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .step-header h2 {
                font-size: 24px;
            }
            
            .success-title {
                font-size: 28px;
            }
            
            .success-icon {
                font-size: 60px;
            }
        }

        .stickImage{
            object-fit: contain !important;
            width: 100% !important;
            height: 164px !important;
        }


        .app-main-loader {
  border: 8px solid #f3f3f3;
  border-radius: 100%;
  border-top: 8px solid #3498db;
  width: 60px;
  height: 60px;
  -webkit-animation: spinn 1s linear infinite; 
  animation: spinn 1s linear infinite;
}

/* Safari */
@-webkit-keyframes spinn {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spinn {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
    </style>
</head>
<body>
    <header class="header-area header-sticky">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <nav class="main-nav">
                        <a href="./index.html" class="logo">
                            <img src="assets/images/logo.png" alt="Softy Pinko" height="20px"/>
                        </a>
                        <ul class="nav">
                            <li><a href="./index.html">Home</a></li>
                            <li class="dropdown">
                                <a href="./products.html" onclick="toggleDropdown(this)">
                                    Products <i class="fas fa-caret-down"></i>
                                </a>
                                <ul class="dropdown-menu-div">
                                    <li><a href="./ai-digital-walking-stick.html">AI Digital walking stick</a></li>
                                    <li><a href="./digital-walking-stick.html">Digital walking stick</a></li>
                                    <li><a href="./whitecane.html">White cane</a></li>
                                </ul>
                            </li>
                            <li><a href="./about.html">About Us</a></li>
                            <li class="dropdown">
                                <a href="javascript:void(0);" onclick="toggleDropdown(this)">
                                    Partnerships <i class="fas fa-caret-down"></i>
                                </a>
                                <ul class="dropdown-menu-div">
                                    <li><a href="./corporate-partnership.html">Corporate partnership</a></li>
                                    <li><a href="./rd-partnership.html">R&D partnership</a></li>
                                </ul>
                            </li>
                            <li><a href="./contactus.html">Help center</a></li>
                            <li class="dropdown">
                                <a href="javascript:void(0);" onclick="toggleDropdown(this)">
                                    <img class="wpml-ls-flag" src="https://www.countryflags.com/wp-content/uploads/united-kingdom-flag-png-large.png" alt="EN" width="20" height="20"> <i class="fas fa-caret-down"></i>
                                </a>
                                <ul class="dropdown-menu-div">
                                    <li><a href="#"><img class="wpml-ls-flag" src="https://www.countryflags.com/wp-content/uploads/united-kingdom-flag-png-large.png" alt="EN" width="20" height="20"> English</a></li>
                                    <li><a href="#"><img class="wpml-ls-flag" src="https://cdn.countryflags.com/thumbs/france/flag-800.png" alt="FR" width="20" height="20"> French</a></li>
                                    <li><a href="#"><img class="wpml-ls-flag" src="https://www.countryflags.com/wp-content/uploads/kenya-flag-png-large.png" alt="SW" width="20" height="20"> Swahili</a></li>
                                    <li><a href="#"><img class="wpml-ls-flag" src="https://www.countryflags.com/wp-content/uploads/rwanda-flag-png-large.png" alt="RW" width="20" height="20"> Kinyarwanda</a></li>
                                </ul>
                            </li>
                            <li><a href="./checkout.html" class="desktop-order-now-button">Order Now</a></li>
                        </ul>
                        <a class='menu-trigger'>
                            <span>Menu</span>
                        </a>
                    </nav>
                </div>
            </div>
        </div>
    </header>

    <section class="checkout-page-container">
        <div class="container">
            <div class="checkout-container">
                <!-- Progress Header -->
                <div class="progress-header">
                    <div class="progress-steps">
                        <div class="progress-line">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="step active" id="step-1" data-step="1">
                            <div class="step-number"><span>1</span></div>
                            <div class="step-title">Contact Info</div>
                        </div>
                        <div class="step" id="step-2" data-step="2">
                            <div class="step-number"><span>2</span></div>
                            <div class="step-title">Choose Product</div>
                        </div>
                        <div class="step" id="step-3" data-step="3">
                            <div class="step-number"><span>3</span></div>
                            <div class="step-title">Shipping & Payment</div>
                        </div>
                        <div class="step" id="step-4" data-step="4">
                            <div style="z-index: 9999 !important;" class="step-number"><span>4</span></div>
                            <div class="step-title">Order Complete</div>
                        </div>
                    </div>
                </div>

                <!-- Checkout Content -->
                <div class="checkout-content">
                    <!-- Step 1: Contact Information -->
                    <div id="content-step-1" class="step-content">
                        <div class="step-header">
                            <h2>Contact Information</h2>
                            <p>Please provide your contact details to get started with your order.</p>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label" for="email">Email Address *</label>
                            <input type="email" id="email" class="form-input" placeholder="Enter your email address" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="fullName">Full Name *</label>
                            <input type="text" id="fullName" class="form-input" placeholder="Enter your full name" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="country">Country *</label>
                            <select id="country" class="form-input" required>
                                <option value="">Select your country</option>
                            </select>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="agreeTerms" required>
                            <label for="agreeTerms">I agree to Vizion Bot's <a onclick="window.open('/sales-agreement.html')" href="#" style="color: var(--primary-dark); text-decoration: none;">terms and conditions</a> and <a onclick="window.open('/privacy-policy.html')" href="#" style="color: var(--primary-dark); text-decoration: none;">privacy policy</a></label>
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn-primary" onclick="goToStep2()">
                                Continue to Products
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Choose Product -->
                    <div id="content-step-2" class="step-content hidden">
                        <div class="step-header">
                            <h2>Choose Your Product</h2>
                            <p>Select the product that best fits your needs. Each product is designed to enhance mobility and independence.</p>
                        </div>
                        
                        <div id="products-container">
                            <div class="alert alert-info">
                                <i class="fas fa-spinner fa-spin"></i>
                                Loading products...
                            </div>
                        </div>

                        <div id="quantity-section" class="quantity-section hidden">
                            <div class="form-group" style="margin: 0;">
                                <label class="form-label" for="quantity">Quantity</label>
                                <input type="number" id="quantity" class="form-input quantity-input" min="1" value="1">
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn-secondary" onclick="GoBackToStep(1)">
                                <i class="fas fa-arrow-left"></i>
                                Back
                            </button>
                            <button type="button" class="btn-primary" id="continueToShipping" onclick="goToStep3()" disabled>
                                Continue to Shipping
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Shipping & Payment -->
                    <div id="content-step-3" class="step-content hidden">
                        <div class="step-header">
                            <h2>Delivery & Payment</h2>
                            <p>Choose your delivery method and complete your payment to finalize your order.</p>
                        </div>
                        
                        <!-- Delivery Options -->
                        <div class="form-group">
                            <label class="form-label">Delivery Method *</label>
                            <div class="delivery-options">
                                <div class="delivery-option" onclick="selectDelivery('pickup')">
                                    <div class="delivery-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <h4>Office Pickup</h4>
                                    <p>Collect from our office in Kigali, Rwanda</p>
                                </div>
                                <div class="delivery-option" onclick="selectDelivery('shipping')">
                                    <div class="delivery-icon">
                                        <i class="fas fa-shipping-fast"></i>
                                    </div>
                                    <h4>Home Delivery</h4>
                                    <p>We deliver directly to your address</p>
                                </div>
                            </div>
                        </div>

                        <!-- Shipping Details (Rwanda only) -->
                        <div id="shipping-details" class="hidden">
                            <div class="form-group">
                                <label class="form-label" for="district">District *</label>
                                <select id="district" class="form-input">
                                    <option value="">Select your district</option>
                                </select>
                            </div>
                        </div>

                        <!-- International Shipping Message -->
                        <div id="international-shipping" class="hidden">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i>
                                International shipping rates will be calculated based on your location. Our team will contact you with shipping details and costs.
                            </div>
                        </div>

                        <!-- Order Summary -->
                        <div class="order-summary">
                            <div class="summary-title">
                                <i class="fas fa-receipt"></i>
                                Order Summary
                            </div>
                            <div id="order-summary-content">
                                <!-- Summary will be populated here -->
                            </div>
                        </div>

                        <!-- Payment Methods -->
                        <div class="form-group">
                            <label class="form-label">Payment Method *</label>
                            <div class="payment-methods">
                                <div class="payment-method" id="momo-payment" onclick="selectPayment('momo')">
                                    <div class="payment-icon" style="color: #4CAF50;">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <h4>Mobile Money</h4>
                                    <p>Pay with your mobile money</p>
                                </div>
                                <div class="payment-method" id="card-payment" onclick="selectPayment('card')">
                                    <div class="payment-icon" style="color: #6c757d;">
                                        <i class="fas fa-credit-card"></i>
                                    </div>
                                    <h4>Credit Card</h4>
                                    <p>Visa, Mastercard, etc.</p>
                                </div>
                            </div>
                        </div>

                        <!-- MOMO Payment Details -->
                        <div id="momo-details" class="hidden">
                            <div class="form-group">
                                <label class="form-label">Select Network *</label>
                                <div id="momo-networks" class="network-grid">
                                    <!-- Networks will be populated here -->
                                </div>
                            </div>
                            
                            <div class="form-group hidden" id="phoneNumberGroup">
                                <label class="form-label" for="phoneNumber">Phone Number *</label>
                                <input type="number" id="phoneNumber" class="form-input" placeholder="Enter your phone number">
                            </div>

                            <div class="form-group hidden" id="commentGroup">
                                <label class="form-label" for="comment">Additional Comments (Optional)</label>
                                <textarea id="comment" class="form-input" rows="3" placeholder="Any special instructions or comments..."></textarea>
                            </div>
                        </div>

                        <!-- MOMO Not Supported -->
                        <div id="momo-not-supported" class="hidden">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Mobile Money is not yet available for your country. Please check back later or contact us for alternative payment options.
                            </div>
                        </div>

                        <div class="button-group">
                            <button type="button" class="btn-secondary" onclick="GoBackToStep(2)">
                                <i class="fas fa-arrow-left"></i>
                                Back
                            </button>
                            <button type="button" class="btn-primary" id="payNowBtn" onclick="processPayment()" disabled>
                                <span id="payBtnText">Complete Payment</span>
                                <div class="loading-spinner hidden" id="payBtnLoader"></div>
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Order Complete -->
                    <div id="content-step-4" class="step-content hidden">

                        <div class="success-container hidden" id="paymentFailed">
                            <div class="success-icon">
                                <i class="fas fa-times-circle" style="color: crimson;"></i>
                            </div>
                            <h2 class="success-title" style="color: crimson;">Payment Failed!</h2>
                            <p class="success-message">
                                Your payment failed. Please try again or contact our support team for assistance.
                            </p>
                            <div class="button-group">
                                <button type="button" class="btn-primary" onclick="cancelCheckout()">
                                    <i class="fas fa-plus"></i>
                                    Place Another Order
                                </button>
                            </div>
                        </div>

                        <div class="payment-loading-indicator" id="paymentLoading" style="min-height: 400px;">
<div style="display: flex;width: 100%;justify-content: center;align-items: center;margin-bottom: 30px;">
    <div class="app-main-loader"></div>
</div>
     <p class="success-message">
                            Please wait while we process your payment...
                            </p>

                        </div>

                        <div class="success-container hidden" id="paymentSuccess">
                            <div class="success-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <h2 class="success-title">Payment Successful!</h2>
                            <p class="success-message">
                               Thank you for your order! Your payment has been received successfully. Please check your email for the confirmation details. Your order is now being processed and will be delivered as soon as possible. We truly appreciate your trust in us!
                            </p>
                            <div id="order-details" class="order-details-card">
                                <!-- Order details will be populated here -->
                            </div>
                            <div class="button-group">
                                <button type="button" class="btn-primary" onclick="cancelCheckout()">
                                    <i class="fas fa-plus"></i>
                                    Place Another Order
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

            <div style="width: 100%;display: flex;align-items: center;justify-content: center;padding-top: 50px;">
        <button onclick="cancelCheckout()" style="color: dodgerblue;background-color: transparent;border: none;font-size: 16px;text-decoration: underline;">Cancel checkout</button>
    </div>
    </section>

    <div id="footer"></div>

        <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script src="https://checkout.flutterwave.com/v3.js"></script>

    <script>
        // API Base URL
        const API_BASE_URL = 'https://vizionbotapi-9c45d9dc80e7.herokuapp.com';

        // Global variables for storing checkout data
        let checkoutData = {
            email: '',
            fullName: '',
            country: '',
            selectedProduct: null,
            quantity: 1,
            needShipping: null,
            district: '',
            paymentMethod: '',
            phoneNumber: '',
            comment: '',
            selectedNetwork: ''
        };

        let currentStep = 1;
        let products = [];

        // Countries data
        const countries = 
            [
    {
        "name": "Afghanistan",
        "code": "AF"
    },
    {
        "name": "Albania",
        "code": "AL"
    },
    {
        "name": "Algeria",
        "code": "DZ"
    },
    {
        "name": "Andorra",
        "code": "AD"
    },
    {
        "name": "Angola",
        "code": "AO"
    },
    {
        "name": "Antigua and Barbuda",
        "code": "AG"
    },
    {
        "name": "Argentina",
        "code": "AR"
    },
    {
        "name": "Armenia",
        "code": "AM"
    },
    {
        "name": "Australia",
        "code": "AU"
    },
    {
        "name": "Austria",
        "code": "AT"
    },
    {
        "name": "Azerbaijan",
        "code": "AZ"
    },
    {
        "name": "Bahamas",
        "code": "BS"
    },
    {
        "name": "Bahrain",
        "code": "BH"
    },
    {
        "name": "Bangladesh",
        "code": "BD"
    },
    {
        "name": "Barbados",
        "code": "BB"
    },
    {
        "name": "Belarus",
        "code": "BY"
    },
    {
        "name": "Belgium",
        "code": "BE"
    },
    {
        "name": "Belize",
        "code": "BZ"
    },
    {
        "name": "Benin",
        "code": "BJ"
    },
    {
        "name": "Bhutan",
        "code": "BT"
    },
    {
        "name": "Bolivia",
        "code": "BO"
    },
    {
        "name": "Bosnia and Herzegovina",
        "code": "BA"
    },
    {
        "name": "Botswana",
        "code": "BW"
    },
    {
        "name": "Brazil",
        "code": "BR"
    },
    {
        "name": "Brunei",
        "code": "BN"
    },
    {
        "name": "Bulgaria",
        "code": "BG"
    },
    {
        "name": "Burkina Faso",
        "code": "BF"
    },
    {
        "name": "Burundi",
        "code": "BI"
    },
    {
        "name": "Cabo Verde",
        "code": "CV"
    },
    {
        "name": "Cambodia",
        "code": "KH"
    },
    {
        "name": "Cameroon",
        "code": "CM"
    },
    {
        "name": "Canada",
        "code": "CA"
    },
    {
        "name": "Central African Republic",
        "code": "CF"
    },
    {
        "name": "Chad",
        "code": "TD"
    },
    {
        "name": "Chile",
        "code": "CL"
    },
    {
        "name": "China",
        "code": "CN"
    },
    {
        "name": "Colombia",
        "code": "CO"
    },
    {
        "name": "Comoros",
        "code": "KM"
    },
    {
        "name": "Congo (Congo-Brazzaville)",
        "code": "CG"
    },
    {
        "name": "Costa Rica",
        "code": "CR"
    },
    {
        "name": "Croatia",
        "code": "HR"
    },
    {
        "name": "Cuba",
        "code": "CU"
    },
    {
        "name": "Cyprus",
        "code": "CY"
    },
    {
        "name": "Czechia",
        "code": "CZ"
    },
    {
        "name": "Democratic Republic of the Congo",
        "code": "CD"
    },
    {
        "name": "Denmark",
        "code": "DK"
    },
    {
        "name": "Djibouti",
        "code": "DJ"
    },
    {
        "name": "Dominica",
        "code": "DM"
    },
    {
        "name": "Dominican Republic",
        "code": "DO"
    },
    {
        "name": "Ecuador",
        "code": "EC"
    },
    {
        "name": "Egypt",
        "code": "EG"
    },
    {
        "name": "El Salvador",
        "code": "SV"
    },
    {
        "name": "Equatorial Guinea",
        "code": "GQ"
    },
    {
        "name": "Eritrea",
        "code": "ER"
    },
    {
        "name": "Estonia",
        "code": "EE"
    },
    {
        "name": "Eswatini",
        "code": "SZ"
    },
    {
        "name": "Ethiopia",
        "code": "ET"
    },
    {
        "name": "Fiji",
        "code": "FJ"
    },
    {
        "name": "Finland",
        "code": "FI"
    },
    {
        "name": "France",
        "code": "FR"
    },
    {
        "name": "Gabon",
        "code": "GA"
    },
    {
        "name": "Gambia",
        "code": "GM"
    },
    {
        "name": "Georgia",
        "code": "GE"
    },
    {
        "name": "Germany",
        "code": "DE"
    },
    {
        "name": "Ghana",
        "code": "GH"
    },
    {
        "name": "Greece",
        "code": "GR"
    },
    {
        "name": "Grenada",
        "code": "GD"
    },
    {
        "name": "Guatemala",
        "code": "GT"
    },
    {
        "name": "Guinea",
        "code": "GN"
    },
    {
        "name": "Guinea-Bissau",
        "code": "GW"
    },
    {
        "name": "Guyana",
        "code": "GY"
    },
    {
        "name": "Haiti",
        "code": "HT"
    },
    {
        "name": "Holy See",
        "code": "VA"
    },
    {
        "name": "Honduras",
        "code": "HN"
    },
    {
        "name": "Hungary",
        "code": "HU"
    },
    {
        "name": "Iceland",
        "code": "IS"
    },
    {
        "name": "India",
        "code": "IN"
    },
    {
        "name": "Indonesia",
        "code": "ID"
    },
    {
        "name": "Iran",
        "code": "IR"
    },
    {
        "name": "Iraq",
        "code": "IQ"
    },
    {
        "name": "Ireland",
        "code": "IE"
    },
    {
        "name": "Israel",
        "code": "IL"
    },
    {
        "name": "Italy",
        "code": "IT"
    },
    {
        "name": "Jamaica",
        "code": "JM"
    },
    {
        "name": "Japan",
        "code": "JP"
    },
    {
        "name": "Jordan",
        "code": "JO"
    },
    {
        "name": "Kazakhstan",
        "code": "KZ"
    },
    {
        "name": "Kenya",
        "code": "KE"
    },
    {
        "name": "Kiribati",
        "code": "KI"
    },
    {
        "name": "Kuwait",
        "code": "KW"
    },
    {
        "name": "Kyrgyzstan",
        "code": "KG"
    },
    {
        "name": "Laos",
        "code": "LA"
    },
    {
        "name": "Latvia",
        "code": "LV"
    },
    {
        "name": "Lebanon",
        "code": "LB"
    },
    {
        "name": "Lesotho",
        "code": "LS"
    },
    {
        "name": "Liberia",
        "code": "LR"
    },
    {
        "name": "Libya",
        "code": "LY"
    },
    {
        "name": "Liechtenstein",
        "code": "LI"
    },
    {
        "name": "Lithuania",
        "code": "LT"
    },
    {
        "name": "Luxembourg",
        "code": "LU"
    },
    {
        "name": "Madagascar",
        "code": "MG"
    },
    {
        "name": "Malawi",
        "code": "MW"
    },
    {
        "name": "Malaysia",
        "code": "MY"
    },
    {
        "name": "Maldives",
        "code": "MV"
    },
    {
        "name": "Mali",
        "code": "ML"
    },
    {
        "name": "Malta",
        "code": "MT"
    },
    {
        "name": "Marshall Islands",
        "code": "MH"
    },
    {
        "name": "Mauritania",
        "code": "MR"
    },
    {
        "name": "Mauritius",
        "code": "MU"
    },
    {
        "name": "Mexico",
        "code": "MX"
    },
    {
        "name": "Micronesia",
        "code": "FM"
    },
    {
        "name": "Moldova",
        "code": "MD"
    },
    {
        "name": "Monaco",
        "code": "MC"
    },
    {
        "name": "Mongolia",
        "code": "MN"
    },
    {
        "name": "Montenegro",
        "code": "ME"
    },
    {
        "name": "Morocco",
        "code": "MA"
    },
    {
        "name": "Mozambique",
        "code": "MZ"
    },
    {
        "name": "Myanmar",
        "code": "MM"
    },
    {
        "name": "Namibia",
        "code": "NA"
    },
    {
        "name": "Nauru",
        "code": "NR"
    },
    {
        "name": "Nepal",
        "code": "NP"
    },
    {
        "name": "Netherlands",
        "code": "NL"
    },
    {
        "name": "New Zealand",
        "code": "NZ"
    },
    {
        "name": "Nicaragua",
        "code": "NI"
    },
    {
        "name": "Niger",
        "code": "NE"
    },
    {
        "name": "Nigeria",
        "code": "NG"
    },
    {
        "name": "North Korea",
        "code": "KP"
    },
    {
        "name": "North Macedonia",
        "code": "MK"
    },
    {
        "name": "Norway",
        "code": "NO"
    },
    {
        "name": "Oman",
        "code": "OM"
    },
    {
        "name": "Pakistan",
        "code": "PK"
    },
    {
        "name": "Palau",
        "code": "PW"
    },
    {
        "name": "Palestine State",
        "code": "PS"
    },
    {
        "name": "Panama",
        "code": "PA"
    },
    {
        "name": "Papua New Guinea",
        "code": "PG"
    },
    {
        "name": "Paraguay",
        "code": "PY"
    },
    {
        "name": "Peru",
        "code": "PE"
    },
    {
        "name": "Philippines",
        "code": "PH"
    },
    {
        "name": "Poland",
        "code": "PL"
    },
    {
        "name": "Portugal",
        "code": "PT"
    },
    {
        "name": "Qatar",
        "code": "QA"
    },
    {
        "name": "Romania",
        "code": "RO"
    },
    {
        "name": "Russia",
        "code": "RU"
    },
    {
        "name": "Rwanda",
        "code": "RW"
    },
    {
        "name": "Saint Kitts and Nevis",
        "code": "KN"
    },
    {
        "name": "Saint Lucia",
        "code": "LC"
    },
    {
        "name": "Saint Vincent and the Grenadines",
        "code": "VC"
    },
    {
        "name": "Samoa",
        "code": "WS"
    },
    {
        "name": "San Marino",
        "code": "SM"
    },
    {
        "name": "Sao Tome and Principe",
        "code": "ST"
    },
    {
        "name": "Saudi Arabia",
        "code": "SA"
    },
    {
        "name": "Senegal",
        "code": "SN"
    },
    {
        "name": "Serbia",
        "code": "RS"
    },
    {
        "name": "Seychelles",
        "code": "SC"
    },
    {
        "name": "Sierra Leone",
        "code": "SL"
    },
    {
        "name": "Singapore",
        "code": "SG"
    },
    {
        "name": "Slovakia",
        "code": "SK"
    },
    {
        "name": "Slovenia",
        "code": "SI"
    },
    {
        "name": "Solomon Islands",
        "code": "SB"
    },
    {
        "name": "Somalia",
        "code": "SO"
    },
    {
        "name": "South Africa",
        "code": "ZA"
    },
    {
        "name": "South Korea",
        "code": "KR"
    },
    {
        "name": "South Sudan",
        "code": "SS"
    },
    {
        "name": "Spain",
        "code": "ES"
    },
    {
        "name": "Sri Lanka",
        "code": "LK"
    },
    {
        "name": "Sudan",
        "code": "SD"
    },
    {
        "name": "Suriname",
        "code": "SR"
    },
    {
        "name": "Sweden",
        "code": "SE"
    },
    {
        "name": "Switzerland",
        "code": "CH"
    },
    {
        "name": "Syria",
        "code": "SY"
    },
    {
        "name": "Tajikistan",
        "code": "TJ"
    },
    {
        "name": "Tanzania",
        "code": "TZ"
    },
    {
        "name": "Thailand",
        "code": "TH"
    },
    {
        "name": "Timor-Leste",
        "code": "TL"
    },
    {
        "name": "Togo",
        "code": "TG"
    },
    {
        "name": "Tonga",
        "code": "TO"
    },
    {
        "name": "Trinidad and Tobago",
        "code": "TT"
    },
    {
        "name": "Tunisia",
        "code": "TN"
    },
    {
        "name": "Turkey",
        "code": "TR"
    },
    {
        "name": "Turkmenistan",
        "code": "TM"
    },
    {
        "name": "Tuvalu",
        "code": "TV"
    },
    {
        "name": "Uganda",
        "code": "UG"
    },
    {
        "name": "Ukraine",
        "code": "UA"
    },
    {
        "name": "United Arab Emirates",
        "code": "AE"
    },
    {
        "name": "United Kingdom",
        "code": "GB"
    },
    {
        "name": "United States",
        "code": "US"
    },
    {
        "name": "Uruguay",
        "code": "UY"
    },
    {
        "name": "Uzbekistan",
        "code": "UZ"
    },
    {
        "name": "Vanuatu",
        "code": "VU"
    },
    {
        "name": "Venezuela",
        "code": "VE"
    },
    {
        "name": "Vietnam",
        "code": "VN"
    },
    {
        "name": "Yemen",
        "code": "YE"
    },
    {
        "name": "Zambia",
        "code": "ZM"
    },
    {
        "name": "Zimbabwe",
        "code": "ZW"
    }
]
        

        // Rwanda districts
const rwandaDistricts = [
  // Kigali City
  "Gasabo", "Kicukiro", "Nyarugenge",

  // Eastern Province
  "Bugesera", "Gatsibo", "Kayonza", "Kirehe", "Ngoma", "Rwamagana", "Nyagatare",

  // Northern Province
  "Burera", "Gakenke", "Gicumbi", "Musanze", "Rulindo",

  // Western Province
  "Karongi", "Ngororero", "Nyabihu", "Nyamasheke", "Rubavu", "Rusizi", "Rutsiro",

  // Southern Province
  "Gisagara", "Huye", "Kamonyi", "Muhanga", "Nyamagabe", "Nyanza", "Nyaruguru", "Ruhango"
];


        // MOMO Countries and Networks
        const momoCountries = [
            {
                country: 'Rwanda',
                label: 'Rwanda',
                currency: 'RWF',
                code: 'rw',
                methods: [
                    {
                        type: 'method',
                        name: 'MTN',
                        label:'MTN Mobile Money',
                        image:'https://upload.wikimedia.org/wikipedia/commons/3/3f/MTN-logo.jpg'
                    },
                    {
                        type: 'method',
                        name: 'Airtel',
                        label: 'Airtel Money',
                        image:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRariuS7aPpvkSBCt_mOWH-FbCfq1rr6a4kHA&s'
                    },
                ],
            },
            {
                country: 'Kenya',
                label: 'Kenya',
                currency: 'KES',
                code: 'ke',
                methods: [
                    {
                        type: 'method',
                        name: 'M-Pesa',
                        label: 'M-Pesa',
                        image:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT5zIvPQUcmQNa_-Y7Ak_nFSQezhmgt3oS3Bw&s'
                    }
                ],
            },
            {
                country: 'Ghana',
                label: 'Ghana',
                methods: [
                    {
                        type: 'network',
                        name: 'MTN',
                        label: 'MTN Mobile Money',
                        image:'https://upload.wikimedia.org/wikipedia/commons/3/3f/MTN-logo.jpg'
                    },
                    {
                        type: 'network',
                        name: 'VODAFONE',
                        label: 'VODAFONE',
                        image:'https://1000logos.net/wp-content/uploads/2017/06/Vodafone-Logo.png'
                    },
                    {
                        type: 'network',
                        name: 'TIGO',
                        label: 'Tigo Cash',
                        image:'https://1000logos.net/wp-content/uploads/2020/08/Tigo-Logo.png'
                    }
                ],
                currency: 'GHS',
                code: 'gh'
            },
            {
                country: 'Uganda',
                label: 'Uganda',
                currency: 'UGX',
                code: 'ug',
                methods: [
                    {
                        type: 'network',
                        name: 'MTN',
                        label: 'MTN Mobile Money',
                        image:'https://upload.wikimedia.org/wikipedia/commons/3/3f/MTN-logo.jpg'
                    },
                    {
                        type: 'network',
                        name: 'AIRTEL',
                        label: 'Airtel Money',
                        image:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRariuS7aPpvkSBCt_mOWH-FbCfq1rr6a4kHA&s'
                    },
                ]
            },
            {
                country: 'Tanzania',
                label: 'Tanzania',
                currency: 'TZS',
                code: 'tz',
                methods: [
                    {
                        type: 'network',
                        name: 'Halopesa',
                        label: 'Halopesa',
                        image:'https://pbs.twimg.com/profile_images/1144549441413885952/sZgI8pce_400x400.png'
                    },
                    {
                        type: 'network',
                        name: 'Airtel',
                        label: 'Airtel Money',
                        image:'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRariuS7aPpvkSBCt_mOWH-FbCfq1rr6a4kHA&s'
                    },
                    {
                        type: 'network',
                        name: 'Tigo',
                        label: 'Tigo Cash',
                        image:'https://1000logos.net/wp-content/uploads/2020/08/Tigo-Logo.png'
                    },
                    {
                        type: 'network',
                        name: 'Vodacom',
                        label: 'Vodacom M-Pesa',
                        image:'https://1000logos.net/wp-content/uploads/2017/06/Vodafone-Logo.png'
                    }
                ],
            },
            {
                country: 'Zambia',
                label: 'Zambia',
                currency: 'ZMW',
                code: 'zm',
                methods: [
                    {
                        type: 'network',
                        name: 'MTN',
                        label: 'MTN Mobile Money',
                        image:'https://upload.wikimedia.org/wikipedia/commons/3/3f/MTN-logo.jpg'
                    },
                    {
                        type: 'network',
                        name: 'ZAMTEL',
                        label: 'ZAMTEL',
                        image:'https://zambianobserver.com/wp-content/uploads/2018/08/zamtel-logo.jpg'
                    }
                ],
            }
        ];

        // LocalStorage functions
        function saveToLocalStorage() {
            localStorage.setItem('vizionbot_checkout_data', JSON.stringify(checkoutData));
            localStorage.setItem('vizionbot_checkout_step', currentStep.toString());
        }

        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('vizionbot_checkout_data');
            const savedStep = localStorage.getItem('vizionbot_checkout_step');
            
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    checkoutData = { ...checkoutData, ...parsedData };
                    if(checkoutData?.orderId){
                    showOrderComplete();
                    }
                    populateFormData();
                } catch (error) {
                    console.error('Error loading saved data:', error);
                }
            }
            
            if (savedStep) {
                const step = parseInt(savedStep);
                if (step > 1 && isStepValid(step - 1)) {
                    goToStep(step);
                }
            }
        }

        function clearLocalStorage() {
            localStorage.removeItem('vizionbot_checkout_data');
            localStorage.removeItem('vizionbot_checkout_step');
        }

        // Check if a step is valid (previous steps completed)
        function isStepValid(step) {
            switch(step) {
                case 1:
                    return true;
                case 2:
                    return checkoutData.email && checkoutData.fullName && checkoutData.country;
                case 3:
                    return isStepValid(2) && checkoutData.selectedProduct;
                case 4:
                    return isStepValid(3) && checkoutData.paymentMethod;
                default:
                    return false;
            }
        }

        // Populate form with saved data
        function populateFormData() {
            if (checkoutData.email) document.getElementById('email').value = checkoutData.email;
            if (checkoutData.fullName) document.getElementById('fullName').value = checkoutData.fullName;
            if (checkoutData.country) document.getElementById('country').value = checkoutData.country;
            if (checkoutData.quantity) document.getElementById('quantity').value = checkoutData.quantity;
            if (checkoutData.phoneNumber) document.getElementById('phoneNumber').value = checkoutData.phoneNumber;
            if (checkoutData.comment) document.getElementById('comment').value = checkoutData.comment;
            if (checkoutData.district) document.getElementById('district').value = checkoutData.district;
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadCountries();
            loadProducts();
            loadFromLocalStorage();
            updateURL();
            setupEventListeners();
            
            // Check URL parameters for step
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');
            
            if (tabParam && !localStorage.getItem('vizionbot_checkout_step')) {
                switch(tabParam) {
                    case 'contact-info':
                        goToStep(1);
                        break;
                    case 'choose-product':
                        if (isStepValid(2)) goToStep(2);
                        break;
                    case 'shipping-payment':
                        if (isStepValid(3)) goToStep(3);
                        break;
                    case 'order-complete':
                        if (isStepValid(4)) goToStep(4);
                        break;
                }
            }
        });

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('phoneNumber').addEventListener('input', validateStep3);
            document.getElementById('district').addEventListener('change', function() {
                checkoutData.district = this.value;
                saveToLocalStorage();
                updateOrderSummary();
                validateStep3();
            });
            document.getElementById('quantity').addEventListener('input', function() {
                checkoutData.quantity = parseInt(this.value) || 1;
                saveToLocalStorage();
                updateOrderSummary();
            });
            document.getElementById('email').addEventListener('input', function() {
                checkoutData.email = this.value;
                saveToLocalStorage();
            });
            document.getElementById('fullName').addEventListener('input', function() {
                checkoutData.fullName = this.value;
                saveToLocalStorage();
            });
            document.getElementById('country').addEventListener('change', function() {
                checkoutData.country = this.value;
                saveToLocalStorage();
            });
            document.getElementById('phoneNumber').addEventListener('input', function() {
                checkoutData.phoneNumber = this.value;
                saveToLocalStorage();
            });
            document.getElementById('comment').addEventListener('input', function() {
                checkoutData.comment = this.value;
                saveToLocalStorage();
            });

            // Make step headers clickable
            document.querySelectorAll('.step').forEach(step => {
                step.addEventListener('click', function() {
                    const stepNumber = parseInt(this.dataset.step);
                    if (isStepValid(stepNumber)) {
                        this.classList.add('clickable');
                        goToStep(stepNumber);
                    }
                });
            });
        }

        function GoBackToStep(stepNumber){
             if (isStepValid(stepNumber)) {
                        // this.classList.add('clickable');
                        goToStep(stepNumber);
                    }
        }

        // Load countries into dropdown
        function loadCountries() {
            const countrySelect = document.getElementById('country');
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country.name;
                option.textContent = country.name;
                countrySelect.appendChild(option);
            });
        }

        // Load products from API
        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/products`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log("data",data)
                if (data.success && data.data) {
                    products = data.data;
                    displayProducts();
                } else {
                    throw new Error('Invalid API response format');
                }
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('products-container').innerHTML = 
                    `<div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle"></i>
                        Failed to load products. Please check your connection and try again.
                    </div>`;
            }
        }

        // Display products
        function displayProducts() {
            const container = document.getElementById('products-container');
            container.innerHTML = '';

            if (!products || products.length === 0) {
                container.innerHTML = 
                    `<div class="alert alert-warning">
                        <i class="fas fa-info-circle"></i>
                        No products available at the moment.
                    </div>`;
                return;
            }

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                productCard.onclick = () => selectProduct(product);
                
                // Check if this product is already selected
                if (checkoutData.selectedProduct && checkoutData.selectedProduct._id === product._id) {
                    productCard.classList.add('selected');
                    document.getElementById('quantity-section').classList.remove('hidden');
                    document.getElementById('continueToShipping').disabled = false;
                }
                
                productCard.innerHTML = `
                    <div class="product-info">
                        <div class="product-left">
                            <div class="product-image">
                                <img class="stickImage" src='${product?.image}' />
                            </div>
                            <div class="product-details">
                                <h4>${product.name}</h4>
                                <p>Premium assistive mobility device</p>
                            </div>
                        </div>
                        <div class="product-right">
                            <div class="product-price">${product.price.toLocaleString()} ${product.currency}</div>
                            <button class="select-btn">Select Product</button>
                        </div>
                    </div>
                `;
                
                container.appendChild(productCard);
            });
        }

        // Select product
        function selectProduct(product) {
            // Remove previous selection
            document.querySelectorAll('.product-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.currentTarget.classList.add('selected');
            
            checkoutData.selectedProduct = product;
            saveToLocalStorage();
            document.getElementById('quantity-section').classList.remove('hidden');
            document.getElementById('continueToShipping').disabled = false;
        }

        // Navigation functions
        function goToStep(step) {

            if (!isStepValid(step) && step > 1) {
                showAlert('Please complete the previous steps first.', 'warning');
                return;
            }
            // Hide all steps
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active/completed classes
            document.querySelectorAll('.step').forEach(stepEl => {
                stepEl.classList.remove('active');
            });
            
            // Mark completed steps
            for (let i = 1; i < step; i++) {
                const stepEl = document.getElementById(`step-${i}`);
                stepEl.classList.add('completed');
                stepEl.classList.add('clickable');
            }
            
            // Show current step
            document.getElementById(`content-step-${step}`).classList.remove('hidden');
            document.getElementById(`step-${step}`).classList.add('active');
            
            // Update progress bar
            updateProgressBar(step);
            
            currentStep = step;
            saveToLocalStorage();
            updateURL();

            // Setup step-specific functionality
            if (step === 3) {
                setupShippingOptions();
            }
        }

        function updateProgressBar(step) {
            const progressFill = document.getElementById('progress-fill');
            const progress = ((step - 1) / 3) * 100;
            progressFill.style.width = progress + '%';
        }

        function goToStep1() {
            goToStep(1);
        }

        function goToStep2() {
            // Validate step 1
            const email = document.getElementById('email').value;
            const fullName = document.getElementById('fullName').value;
            const country = document.getElementById('country').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;

            if (!email || !fullName || !country || !agreeTerms) {
                showAlert('Please fill in all required fields and agree to terms and conditions.', 'danger');
                return;
            }

            if (!isValidEmail(email)) {
                showAlert('Please enter a valid email address.', 'danger');
                return;
            }

            // Save data
            checkoutData.email = email;
            checkoutData.fullName = fullName;
            checkoutData.country = country;
            saveToLocalStorage();

            goToStep(2);
        }

        function goToStep3() {
            // Validate step 2
            if (!checkoutData.selectedProduct) {
                showAlert('Please select a product.', 'danger');
                return;
            }

            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            checkoutData.quantity = quantity;
            saveToLocalStorage();

            goToStep(3);
        }

        // Setup shipping options
        function setupShippingOptions() {
            const shippingDetails = document.getElementById('shipping-details');
            const internationalShipping = document.getElementById('international-shipping');
            
            if (checkoutData.country === 'Rwanda') {
                // Load districts for Rwanda
                const districtSelect = document.getElementById('district');
                districtSelect.innerHTML = '<option value="">Select your district</option>';
                rwandaDistricts.forEach(district => {
                    const option = document.createElement('option');
                    option.value = district;
                    option.textContent = district;
                    if (checkoutData.district === district) {
                        option.selected = true;
                    }
                    districtSelect.appendChild(option);
                });
            }
            
            updateOrderSummary();
        }

        // Select delivery option
        function selectDelivery(option) {
            document.querySelectorAll('.delivery-option').forEach(method => {
                method.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            checkoutData.needShipping = (option === 'shipping');
            saveToLocalStorage();
            
            const shippingDetails = document.getElementById('shipping-details');
            const internationalShipping = document.getElementById('international-shipping');
            
            if (option === 'shipping') {
                if (checkoutData.country === 'Rwanda') {
                    shippingDetails.classList.remove('hidden');
                    internationalShipping.classList.add('hidden');
                } else {
                    shippingDetails.classList.add('hidden');
                    internationalShipping.classList.remove('hidden');
                }
            } else {
                shippingDetails.classList.add('hidden');
                internationalShipping.classList.add('hidden');
            }
            
            updateOrderSummary();
            validateStep3();
        }

        // Select payment method
        function selectPayment(method) {
            // if (method === 'card') {
            //     showAlert('Card payment is coming soon!', 'info');
            //     return;
            // }
            
            checkoutData.paymentMethod = method;
            saveToLocalStorage();
            
            document.querySelectorAll('.payment-method:not(.disabled)').forEach(pm => {
                pm.classList.remove('selected');
            });
            
            if (method === 'momo') {
                document.getElementById('momo-payment').classList.add('selected');
                setupMomoPayment();
            }

            if(method == 'card'){
                     const phoneGroup = document.getElementById('phoneNumberGroup');
            phoneGroup.classList.add('hidden');

            const commentGroup = document.getElementById('commentGroup');
            commentGroup.classList.add('hidden');
                    
                document.getElementById('card-payment').classList.add('selected');
                document.getElementById("momo-details").classList.add("hidden");

            validateStep3();
            }
        }

        // Setup MOMO payment
        function setupMomoPayment() {
            const momoDetails = document.getElementById('momo-details');
            const momoNotSupported = document.getElementById('momo-not-supported');
            const networksContainer = document.getElementById('momo-networks');
            
            // Find country in MOMO countries
            const countryData = momoCountries.find(c => c.country === checkoutData.country);
            
            if (!countryData || !countryData.methods || countryData.methods.length === 0) {
                momoDetails.classList.add('hidden');
                momoNotSupported.classList.remove('hidden');
                document.getElementById('payNowBtn').disabled = true;
                return;
            }
            
            momoNotSupported.classList.add('hidden');
            momoDetails.classList.remove('hidden');
            
            // Display networks
            networksContainer.innerHTML = '';
            countryData.methods.forEach(method => {
                const networkDiv = document.createElement('div');
                networkDiv.className = 'network-option';
                networkDiv.onclick = () => selectNetwork(method.name);
                
                // Check if this network is already selected
                if (checkoutData.selectedNetwork === method.name) {
                  const phoneGroup = document.getElementById('phoneNumberGroup');
            phoneGroup.classList.remove('hidden');

            const commentGroup = document.getElementById('commentGroup');
            commentGroup.classList.remove('hidden');
                    networkDiv.classList.add('selected');
                }
                
                networkDiv.innerHTML = `
                    <img src="${method.image}" alt="${method.label}" class="network-image" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.marginTop='0';">
                    <div class="network-name">${method.label}</div>
                `;
                
                networksContainer.appendChild(networkDiv);
            });
            
            validateStep3();
        }

        // Select network
        function selectNetwork(network) {
            document.querySelectorAll('.network-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            checkoutData.selectedNetwork = network;
            saveToLocalStorage();
            validateStep3();

            const phoneGroup = document.getElementById('phoneNumberGroup');
            phoneGroup.classList.remove('hidden');

            const commentGroup = document.getElementById('commentGroup');
            commentGroup.classList.remove('hidden');
        }

        // Update order summary
        function updateOrderSummary() {
            if (!checkoutData.selectedProduct) return;
            
            const product = checkoutData.selectedProduct;
            const quantity = checkoutData.quantity || 1;
            const subtotal = product.price * quantity;
            
            let shippingFee = 0;
            if (checkoutData.needShipping && checkoutData.country === 'Rwanda') {
                const district = document.getElementById('district').value;
                const kigaliDistricts = ['Gasabo', 'Kicukiro', 'Nyarugenge'];
                
                if (kigaliDistricts.includes(district)) {
                    shippingFee = product.shippingFeeInKigali || 0;
                } else if (district) {
                    shippingFee = product.shippingFeeOutSideKigali || 0;
                }
            }
            
            const total = subtotal + shippingFee;
            
            const summaryHTML = `
                <div class="summary-row">
                    <span>${product.name}  ${quantity}</span>
                    <span>${subtotal.toLocaleString()} ${product.currency}</span>
                </div>
                ${shippingFee > 0 ? `
                <div class="summary-row">
                    <span>Shipping Fee</span>
                    <span>${shippingFee.toLocaleString()} ${product.currency}</span>
                </div>
                ` : ''}
                <div class="summary-row total">
                    <span>Total Amount</span>
                    <span>${total.toLocaleString()} ${product.currency}</span>
                </div>
            `;
            
            document.getElementById('order-summary-content').innerHTML = summaryHTML;
            document.getElementById('payBtnText').textContent = `Pay ${total.toLocaleString()} ${product.currency}`;
        }

      // Validate step 3 (continued from the cutoff)
        function validateStep3() {
            const phoneNumber = document.getElementById('phoneNumber').value;
            const hasDeliveryOption = checkoutData.needShipping !== null;
            const hasPaymentMethod = checkoutData.paymentMethod === 'momo' || checkoutData.paymentMethod === 'card';
            const hasNetwork = checkoutData.selectedNetwork;
            const hasPhone = phoneNumber && phoneNumber.length > 0;
            
            // Check if shipping is needed and district is selected for Rwanda
            let shippingValid = true;
            if (checkoutData.needShipping && checkoutData.country === 'Rwanda') {
                const district = document.getElementById('district').value;
                shippingValid = district !== '';
            }
            const isValid = hasDeliveryOption && hasPaymentMethod && (checkoutData.paymentMethod == 'card'? true : hasNetwork && hasPhone && checkoutData.paymentMethod === 'momo') && shippingValid;
            document.getElementById('payNowBtn').disabled = !isValid;
        }

        // Process payment
        async function processPayment() {
            const payBtn = document.getElementById('payNowBtn');
            const payBtnText = document.getElementById('payBtnText');
            const payBtnLoader = document.getElementById('payBtnLoader');
            
              // Disable button and show loader
            payBtn.disabled = true;
            payBtnText.style.display = 'none';
            payBtnLoader.classList.remove('hidden');
            
            try {
                // Prepare payment data
                const paymentData = {
                       email: checkoutData.email,
        country: checkoutData.country,
        productId: checkoutData.selectedProduct._id,
        city: "Kigali",
        fullName: checkoutData.fullName,
        network: checkoutData.selectedNetwork,
               quantity: checkoutData.quantity,
                    needShipping: checkoutData.needShipping,
                    district: checkoutData.district,
                    paymentMethod: checkoutData.paymentMethod,
                    phoneNumber: checkoutData.phoneNumber,
                    comment: checkoutData.comment,
                };

                if(checkoutData.paymentMethod == 'card' || checkoutData.paymentMethod == 'CARD'){

                      const response = await fetch(`${API_BASE_URL}/api/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(paymentData)
                });
                
                const data = await response.json();
                if (data.success) {
                        payBtn.disabled = false;
                payBtnText.style.display = 'inline';
                payBtnLoader.classList.add('hidden');

                     checkoutData.orderId = data.data._id;
                    checkoutData.orderDate = new Date().toLocaleDateString();
                    saveToLocalStorage();
                    showOrderComplete(data.data);
                
        const userEmail = checkoutData.email; 
      const amount = data?.data?.totalPrice;
      const tx_ref = "TX_REF_" + Math.floor((Math.random() * 1000000000) + 1);

      FlutterwaveCheckout({
        public_key: "FLWPUBK_TEST-8e475941a8822611ea8ce636432f4b14-X", // Get from your Flutterwave dashboard
        tx_ref: tx_ref,
        amount: amount,
        currency: data?.data?.currency, // or your desired currency
        country: checkoutData.country, // or your desired country
        // payment_options: 'card, ',
        redirect_url: 'https://vizion-bot-website.vercel.app/checkout.html?tab=order-complete',
        customer: {
          email: userEmail,
          name: checkoutData.fullName,
        },
         meta: {
          orderId: data.data._id
        },
        callback: function (payment) {
          // This function is called after a successful payment.
          console.log(payment);
          
          // You must verify the transaction with your server.
          // Never trust the frontend callback alone!
          // Make an HTTP request to your Node.js endpoint here.
        //   fetch('/verify-payment', {
        //     method: 'POST',
        //     headers: { 'Content-Type': 'application/json' },
        //     body: JSON.stringify({ transaction_id: payment.transaction_id })
        //   })
        //   .then(response => response.json())
        //   .then(data => {
        //     if (data.status === 'success') {
        //       alert('Payment successful and verified!');
        //       // Redirect to a success page or update UI
        //     } else {
        //       alert('Payment failed verification. Please contact support.');
        //     }
        //   });
        },
        onclose: function() {
          // You can handle modal closure here
        },
        customizations: {
          title: "Vizion Bot",
          description: "Payment for "+checkoutData.selectedProduct?.name,
          logo: "https://www.vizionbot.org/images/logo_croped.png",
          theme: {
      // The primary brand color for buttons and other elements
      "primary-color": "#0079A5", 
      // A secondary color for elements
      "secondary-color": "#3EC6EC",
      // The color for the background of the modal
      "background-color": "#f2f2f2",
      // Color of the font
      "font-color": "#333",
      // Color for modal overlay
      "overlay-color": "rgba(0, 0, 0, 0.7)",
      // Color for input fields
      "input-color": "#fff",
      // Color for input borders
      "input-border-color": "#3EC6EC"
    }
        },
          });

                    return;
                }
                }
                
                const response = await fetch(`${API_BASE_URL}/api/orders`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(paymentData)
                });
                
                const data = await response.json();
                if (data.success) {
                    window.open(data.meta.paymentLink)
                    // Store order details for display
                    checkoutData.orderId = data.data._id;
                    checkoutData.orderDate = new Date().toLocaleDateString();
                    saveToLocalStorage();
                    showOrderComplete(data.data);
                } else {
                    throw new Error(data.message || 'Payment failed');
                }
                
            } catch (error) {
                console.error('Payment error:', error);
                showAlert(`Payment failed: ${error.message}`, 'danger');
                
                // Re-enable button
                payBtn.disabled = false;
                payBtnText.style.display = 'inline';
                payBtnLoader.classList.add('hidden');
            }
        }

        // Show order complete
        function showOrderComplete(orderData) {
            const product = checkoutData.selectedProduct;
            const quantity = checkoutData.quantity || 1;
            const subtotal = product.price * quantity;
            
            let shippingFee = 0;
            if (checkoutData.needShipping && checkoutData.country === 'Rwanda') {
                const kigaliDistricts = ['Gasabo', 'Kicukiro', 'Nyarugenge'];
                if (kigaliDistricts.includes(checkoutData.district)) {
                    shippingFee = product.shippingFeeInKigali || 0;
                } else if (checkoutData.district) {
                    shippingFee = product.shippingFeeOutSideKigali || 0;
                }
            }
            
            const total = subtotal + shippingFee;
            
            const orderDetailsHTML = `
                <div class="detail-row">
                    <span class="detail-label">Order ID:</span>
                    <span class="detail-value">${orderData?.orderId || checkoutData.orderId}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Date:</span>
                    <span class="detail-value">${checkoutData.orderDate}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Product:</span>
                    <span class="detail-value">${product.name}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Quantity:</span>
                    <span class="detail-value">${quantity}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Email:</span>
                    <span class="detail-value">${checkoutData.email}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Phone:</span>
                    <span class="detail-value">${checkoutData.phoneNumber}</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Payment Method:</span>
                    <span class="detail-value">${checkoutData.selectedNetwork} Mobile Money</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Delivery:</span>
                    <span class="detail-value">${checkoutData.needShipping ? 'Home Delivery' : 'Office Pickup'}</span>
                </div>
                ${checkoutData.needShipping && checkoutData.district ? `
                <div class="detail-row">
                    <span class="detail-label">District:</span>
                    <span class="detail-value">${checkoutData.district}</span>
                </div>
                ` : ''}
                <div class="detail-row">
                    <span class="detail-label">Total Amount:</span>
                    <span class="detail-value">${total.toLocaleString()} ${product.currency}</span>
                </div>
            `;
            
            document.getElementById('order-details').innerHTML = orderDetailsHTML;
            goToStep(4);
        }

        // Start new order
        function startNewOrder() {
            // Clear all data
            checkoutData = {
                email: '',
                fullName: '',
                country: '',
                selectedProduct: null,
                quantity: 1,
                needShipping: null,
                district: '',
                paymentMethod: '',
                phoneNumber: '',
                comment: '',
                selectedNetwork: ''
            };
            
            clearLocalStorage();
            
            // Reset form
            document.getElementById('email').value = '';
            document.getElementById('fullName').value = '';
            document.getElementById('country').value = '';
            document.getElementById('quantity').value = 1;
            document.getElementById('phoneNumber').value = '';
            document.getElementById('comment').value = '';
            document.getElementById('district').value = '';
            document.getElementById('agreeTerms').checked = false;
            
            // Clear selections
            document.querySelectorAll('.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            document.getElementById('quantity-section').classList.add('hidden');
            document.getElementById('continueToShipping').disabled = true;
            
            // Go to step 1
            goToStep(1);
        }

        // Utility functions
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function showAlert(message, type = 'info') {
            // Remove any existing alerts
            const existingAlert = document.querySelector('.alert');
            if (existingAlert && !existingAlert.classList.contains('order-summary')) {
                existingAlert.remove();
            }
            
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            
            let icon = 'fas fa-info-circle';
            if (type === 'danger') icon = 'fas fa-exclamation-triangle';
            if (type === 'warning') icon = 'fas fa-exclamation-circle';
            if (type === 'success') icon = 'fas fa-check-circle';
            
            alert.innerHTML = `
                <i class="${icon}"></i>
                ${message}
            `;
            
            // Insert at the top of current step content
            const currentStepContent = document.querySelector('.step-content:not(.hidden)');
            currentStepContent.insertBefore(alert, currentStepContent.firstChild);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        function updateURL() {
            const stepNames = {
                1: 'contact-info',
                2: 'choose-product', 
                3: 'shipping-payment',
                4: 'order-complete'
            };
            const currentUrl = window.location.href;

            const newURL = new URL(window.location);
            newURL.searchParams.set('tab', stepNames[currentStep]);
            if(currentStep == 4){
window.history.replaceState({}, '', newURL);
return
            }
            if(currentUrl != newURL){
           window.location.href = newURL;
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', function(event) {
            const urlParams = new URLSearchParams(window.location.search);
            const tabParam = urlParams.get('tab');
            
            const stepMap = {
                'contact-info': 1,
                'choose-product': 2,
                'shipping-payment': 3,
                'order-complete': 4
            };
            
            const targetStep = stepMap[tabParam] || 1;
            if (isStepValid(targetStep)) {
                goToStep(targetStep);
            }
        });

        // Auto-save form data on input changes
        document.addEventListener('input', function(e) {
            if (e.target.matches('input, select, textarea')) {
                // Debounce saving to avoid too many saves
                clearTimeout(window.autoSaveTimeout);
                window.autoSaveTimeout = setTimeout(() => {
                    saveToLocalStorage();
                }, 500);
            }
        });


        // process socket event here


  // Connect to your backend server
    const socket = io("https://vizionbotapi-9c45d9dc80e7.herokuapp.com", {
    transports: ["websocket", "polling"],
    reconnectionAttempts: 5, // try a few times
    timeout: 5000, // 5s timeout
  });

  socket.on("connect", () => {
    console.log(" Connected! Socket ID:", socket.id);
  });

  socket.on("connect_error", (err) => {
    console.error(" Connection error:", err);
  });

  socket.on("disconnect", (reason) => {
    console.log("Disconnected:", reason);
  });

socket.on("payment_successful", (data) => {
    const {
         orderId,
        // amount,
        // paymentStatus,
        // currency,
    } = data;
    console.log("Message from server:", data);

    if(orderId == checkoutData?.orderId){
      const paymentLoading = document.getElementById('paymentLoading');
      paymentLoading.classList.add('hidden');

      const paymentSuccess = document.getElementById('paymentSuccess');
      paymentSuccess.classList.remove('hidden');
    }
});

socket.on("payment_failed", (data) => {
    const {
         orderId,
        // amount,
        // paymentStatus,
        // currency,
    } = data;

    console.log("Message from server:", data);

    if(orderId == checkoutData?.orderId){
      const paymentLoading = document.getElementById('paymentLoading');
      paymentLoading.classList.add('hidden');

      const paymentFailed = document.getElementById('paymentFailed');
      paymentFailed.classList.remove('hidden');
    }
});

    </script>

    <!-- Bootstrap and other scripts -->
    <script src="assets/js/jquery-2.1.0.min.js"></script>
    <script src="assets/js/popper.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/scrollreveal.min.js"></script>
    <script src="assets/js/waypoints.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/imgfix.min.js"></script>
    <script src="assets/js/custom.js"></script>

    <script>
        function showContent(sectionId) {
            // Hide all content sections
            const sections = document.querySelectorAll('.content-section');
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all sidebar items
            const sidebarItems = document.querySelectorAll('.sidebar-item');
            sidebarItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected content section
            document.getElementById(sectionId).classList.add('active');
            
            // Add active class to clicked sidebar item
            event.target.classList.add('active');
        }
    </script>

    <!-- Font Awesome -->
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>

    <!-- jQuery -->
    <script src="assets/js/jquery-2.1.0.min.js"></script>

    <!-- Bootstrap -->
    <script src="assets/js/popper.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>

    <!-- Plugins -->
    <script src="assets/js/scrollreveal.min.js"></script>
    <script src="assets/js/waypoints.min.js"></script>
    <script src="assets/js/jquery.counterup.min.js"></script>
    <script src="assets/js/imgfix.min.js"></script>

    <!-- Global Init -->
    <script src="assets/js/custom.js"></script>

    <script>
        fetch("footer.html")
            .then(response => response.text())
            .then(html => {
                document.getElementById("footer").innerHTML = html;
            })
            .catch(err => console.error("Footer load failed:", err));
    </script>

    <script>
        function toggleDropdown(anchor) {
            if (window.innerWidth > 991) return;
            const currentDropdown = anchor.parentElement;

            const allDropdowns = document.querySelectorAll("li.dropdown");

            allDropdowns.forEach((dropdown) => {
                if (dropdown === currentDropdown) {
                    dropdown.classList.toggle("open");
                } else {
                    dropdown.classList.remove("open");
                }
            });
        }
    </script>

    <script>
        const cancelCheckout = ()=>{
            window.localStorage.clear();
            window.location.href = "./checkout.html";
        }
    </script>


<script>
     const urlParams = new URLSearchParams(window.location.search);
  
  // Check if "transaction_id" exists
  const transactionId = urlParams.get("transaction_id");
  
  if (transactionId) {
    // Call your API endpoint
    setTimeout(() => {
        fetch(`https://vizionbotapi-9c45d9dc80e7.herokuapp.com/api/orders/transaction/${transactionId}`)
      .then(response => {
        if (!response.ok) throw new Error("Network response was not ok");
        return response.json();
      })
      .then(data => {
        console.log("Transaction data:", data);
      })
      .catch(error => {
       alert("Transaction not found")
      });
    }, 3000);
  } else {
    console.log("No transaction_id parameter in URL");
  }
</script>


</body>
</html>